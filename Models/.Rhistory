datacom$RFMQ211
data.frame(medincome=datacom$RFMQ211)
data.frame(medincome=datacom$RFMQ211,comid=datacom$DCOMIRIS)
as.tbl(data.frame(medincome=datacom$RFMQ211,comid=datacom$DCOMIRIS))
cdata=as.tbl(data.frame(medincome=datacom$RFMQ211,comid=datacom$DCOMIRIS))
jdata=inner_join(ids,cdata,by=c("ids","comid"))
cdata=as.tbl(data.frame(medincome=datacom$RFMQ211,ids=datacom$DCOMIRIS))
jdata=inner_join(ids,cdata,by=c("ids"))
jdata
jdata=left_join(ids,cdata,by=c("ids"))
jdata
jadata$medincome
jdata$medincome
cdata
jdata=right_join(ids,cdata,by=c("ids"))
jdata
jdata=left_join(ids,cdata,by=c("ids"))
jdata
which(cdata$ids==690010000)
which(cdata$ids=="690010000"")
""
which(cdata$ids=="690010000")
datacom$DCOMIRIS = paste0(datacom$COM,"0000")
ids = as.tbl(data.frame(ids=as.character(iris@data$DCOMIRIS)))
cdata=as.tbl(data.frame(medincome=datacom$RFMQ211,ids=datacom$DCOMIRIS))
jdata=left_join(ids,cdata,by=c("ids"))
jdata
idata=as.tbl(data.frame(medincome=datairis$RFMQ211,ids=datairis$DCOMIRIS))
idata
jdata=left_join(jdata,idata)
idata=as.tbl(data.frame(medincome=datairis$RFMQ211,ids=datairis$DCOMIRIS))
jdata=left_join(ids,cdata,by=c("ids"))
jdata=left_join(jdata,idata,by=c("ids"))
jdata
jdata=left_join(ids,cdata,by=c("ids"))
jdata=left_join(jdata,idata,by=c("ids"),copy=TRUE)
jadta
jdata
as.numeric(is.na(jdata$medincome.x))
as.numeric(is.na(jdata$medincome.x))+as.numeric(is.na(jdata$medincome.y))
help(ifelse)
ifelse(!is.na(jdata$medincome.y),jdata$medincome.y,jdata$medincome.x)
as.numeric(!is.na(jdata$medincome.x))+as.numeric(!is.na(jdata$medincome.y))
jdata$medincome.x*as.numeric(!is.na(jdata$medincome.x))+ jdata$medincome.y*as.numeric(!is.na(jdata$medincome.y))
jdata$medincome = ifelse(!is.na(jdata$medincome.y),jdata$medincome.y,jdata$medincome.x) # rq : a ifelse could do that easily
jdata
diag
help("diag")
diag(jdata$medincome)
x = jdata$medincome - mean(jdata$medincome )
x
x = jdata$medincome - mean(jdata$medincome,na.rm=TRUE )
x
spweights*diag(x)
head(spweights*diag(x))
help(%*%)
help("%*%")
spweights%*%diag(x)
spweights
as.matrix(spweights)%*%diag(x)
diag(x)
d=diag(x)
d[1:10,1:10]
m=as.matrix(spweights)
m[1:10,1:10]
w=as.matrix(spweights)
diag(w)<- 0
w[1:10,1:10]
as.matrix(x,nrow=length(x))
matrix(x,nrow=length(x))
matrix(x,ncol=length(x))%*%matrix(x,nrow=length(x))
x[is.na(x)]=0
centroids = gCentroid(iris,byid = TRUE)
spweights = 1/spDists(centroids@coords)
w=as.matrix(spweights)
diag(w)<- 0
localmorans = diag(x)%*%as.matrix(spweights)%*%matrix(x,nrow=length(x))
localmorans
localmorans = (diag(x)%*%as.matrix(spweights))%*%matrix(x,nrow=length(x))
localmorans
matrix(x,nrow=length(x))
(diag(x)%*%as.matrix(spweights))
as.matrix(spweights)
diag(x)
d=diag(x)
d[1:10,1:10]
d=d[1:10,1:10]
m=as.matrix(spweights)
m=m[1:10,1:10]
m
localmorans = (diag(x)%*%w)%*%matrix(x,nrow=length(x))
localmorans
matrix(x,ncol=length(x))%*%matrix(x,nrow=length(x))
w%*%matrix(rep(1,length(x)),nrow=length(x))
localmorans = localmorans / ((w%*%matrix(rep(1,length(x)),nrow=length(x)))*(matrix(x,ncol=length(x))%*%matrix(x,nrow=length(x))))
matrix(rep(1,length(x)),nrow=length(x))
dim(w)
w%*%matrix(rep(1,length(x)),nrow=length(x))
((w%*%matrix(rep(1,length(x)),nrow=length(x)))*(matrix(x,ncol=length(x))%*%matrix(x,nrow=length(x))))
(matrix(x,ncol=length(x))%*%matrix(x,nrow=length(x))))
(matrix(x,ncol=length(x))%*%matrix(x,nrow=length(x)))
localmorans = localmorans / ((w%*%matrix(rep(1,length(x)),nrow=length(x)))*(matrix(x,ncol=length(x))%*%matrix(x,nrow=length(x)))[1,1])
localmorans
length(which(localmorans==0))
length(which(is.na(jdata$medincome)))
localmorans[localmorans==0]=NA
localmorans
data.frame(DCOMIRIS=ids,localmoran=localmorans)
choroLayer(spdf = iris,
df = data.frame(DCOMIRIS=ids,localmoran=localmorans),
var="localmoran",
col=cols,
nclass=10
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
#add=FALSE
)
plot(spdata,border = "grey20", lwd=0.75, add=TRUE)
iris@data$DCOMIRIS
choroLayer(spdf = iris,
df = data.frame(DCOMIRIS=ids,localmoran=localmorans),
var="localmoran",
col=cols,
nclass=10
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
#add=FALSE
)
plot(spdata,border = "grey20", lwd=0.75, add=TRUE)
plot(spdata, border = NA, col = NA, bg = "#E3DEBF")
choroLayer(spdf = iris,
df = data.frame(DCOMIRIS=ids,localmoran=localmorans),
var="localmoran",
col=cols,
nclass=10
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
#add=FALSE
)
plot(spdata,border = "grey20", lwd=0.75, add=TRUE)
localmorans
ids
df = data.frame(DCOMIRIS=as.character(ids),localmoran=localmorans),
choroLayer(spdf = iris,
df = data.frame(DCOMIRIS=as.character(ids),localmoran=localmorans),
var="localmoran",
col=cols,
nclass=10
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
#add=FALSE
)
p
choroLayer(spdf = iris,
df = datacom,
var="RFMQ211",
col=cols,
nclass=10
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
#add=FALSE
)
datacom
head(datacom)
choroLayer(spdf = iris,
df = data.frame(DCOMIRIS=as.numeric(ids),localmoran=localmorans),
var="localmoran",
col=cols,
nclass=10
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
#add=FALSE
)
plot(spdata,border = "grey20", lwd=0.75, add=TRUE)
ids
choroLayer(spdf = iris,
df = data.frame(DCOMIRIS=as.numeric(ids$ids),localmoran=localmorans),
var="localmoran",
col=cols,
nclass=10
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
#add=FALSE
)
plot(spdata,border = "grey20", lwd=0.75, add=TRUE)
as.numeric(ids$ids)
as.tbl(datacom)
as.tbl(iris@data)
data.frame(DCOMIRIS=ids,localmoran=localmorans)
choroLayer(spdf = iris,
df = data.frame(DCOMIRIS=ids,localmoran=localmorans),
var="localmoran",
col=cols,
nclass=10
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
#add=FALSE
)
plot(spdata,border = "grey20", lwd=0.75, add=TRUE)
head(datacom)
head(data.frame(DCOMIRIS=ids,localmoran=localmorans))
df=data.frame(DCOMIRIS=ids,localmoran=localmorans)
df
df=data.frame(DCOMIRIS=ids,localmoran=localmorans);names(df)[1]="DCOMIRIS"
choroLayer(spdf = iris,
df = df,
var="localmoran",
col=cols,
nclass=10
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
#add=FALSE
)
plot(spdata,border = "grey20", lwd=0.75, add=TRUE)
head(df)
plot(spdata,border = "grey20", lwd=0.75, add=TRUE)
plot(spdata, border = NA, col = NA, bg = "#E3DEBF")
choroLayer(spdf = iris,
df = df,
var="localmoran",
col=cols,
nclass=10
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
#add=FALSE
)
choroLayer(spdf = iris,
df = df,
var="localmoran",
col=cols,
nclass=10,
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
add=TRUE
)
iris@data$DCOMIRIS
df=data.frame(DCOMIRIS=iris@data$DCOMIRIS,localmoran=localmorans);names(df)[1]="DCOMIRIS"
df
names(df)
choroLayer(spdf = iris,
df = df,
var="localmoran",
col=cols,
nclass=10,
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
add=TRUE
)
plot(spdata,border = "grey20", lwd=0.75, add=TRUE)
choroLayer(spdf = iris,
df = datairis,
var="RFMQ211",
col=cols,
nclass=10
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
#add=FALSE
)
datairis <- read.csv('../Data/raw/iris/structure-distrib-revenus-iris-2011/RFDM2011IRI.csv',sep=';')
names(datairis)[1]="DCOMIRIS"
choroLayer(spdf = iris,
df = datairis,
var="RFMQ211",
col=cols,
nclass=10
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
#add=FALSE
)
datacom <- read.csv('../Data/raw/iris/structure-distrib-revenus-com-2011/RFDM2011COM.csv',sep=';')
datacom$DCOMIRIS = paste0(datacom$COM,"0000")
#plot(spdata, border = NA, col = NA, bg = "#A6CAE0")
plot(spdata, border = NA, col = NA, bg = "#E3DEBF")
#plot(spdata, col  = "#E3DEBF", border=NA, add=TRUE)
choroLayer(spdf = iris,
df = datacom,
var="RFMQ211",
col=cols,
nclass=10
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
#add=FALSE
)
plot(spdata,border = "grey20", lwd=0.75, add=TRUE)
names(iris@data)
datacom <- read.csv('../Data/raw/iris/structure-distrib-revenus-com-2011/RFDM2011COM.csv',sep=';')
datacom$DCOMIRIS = paste0(datacom$COM,"0000")
#plot(spdata, border = NA, col = NA, bg = "#A6CAE0")
plot(spdata, border = NA, col = NA, bg = "#E3DEBF")
#plot(spdata, col  = "#E3DEBF", border=NA, add=TRUE)
choroLayer(spdf = iris,
df = datacom,
var="RFMQ211",
col=cols,
nclass=10
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
#add=FALSE
)
plot(spdata,border = "grey20", lwd=0.75, add=TRUE)
plot(spdata, border = NA, col = NA, bg = "#E3DEBF")
#plot(spdata, col  = "#E3DEBF", border=NA, add=TRUE)
choroLayer(spdf = iris,
df = datairis,
var="RFMQ211",
col=cols,
nclass=10
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
#add=FALSE
)
plot(spdata,border = "grey20", lwd=0.75, add=TRUE)
plot(spdata, border = NA, col = NA, bg = "#E3DEBF")
#plot(spdata, col  = "#E3DEBF", border=NA, add=TRUE)
choroLayer(spdf = iris,
df = datairis,
var="RFMQ211",
col=cols,
nclass=5
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
#add=FALSE
)
plot(spdata,border = "grey20", lwd=0.75, add=TRUE)
#plot(spdata, border = NA, col = NA, bg = "#A6CAE0")
plot(spdata, border = NA, col = NA, bg = "#E3DEBF")
#plot(spdata, col  = "#E3DEBF", border=NA, add=TRUE)
choroLayer(spdf = iris,
df = datairis,
var="RFMQ211",
col=cols,
#nclass=5
breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
#add=FALSE
)
plot(spdata,border = "grey20", lwd=0.75, add=TRUE)
head(datacom)
head(datairis)
spdata = merge(iris,data)
plot(spdata, border = NA, col = NA, bg = "#E3DEBF")
#plot(spdata, col  = "#E3DEBF", border=NA, add=TRUE)
choroLayer(spdf = spdata,
df = datairis,
var="RFMQ211",
col=cols,
#nclass=5
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
#add=FALSE
)
plot(spdata,border = "grey20", lwd=0.75, add=TRUE)
spdata =merge(iris,df)
plot(spdata, border = NA, col = NA, bg = "#E3DEBF")
choroLayer(spdf = spdata,
df = df,
var="localmoran",
col=cols,
nclass=10
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
#add=TRUE
)
plot(spdata,border = "grey20", lwd=0.75, add=TRUE)
summary(localmorans)
choroLayer(spdf = spdata,
df = df,
var="localmoran",
col=cols,
nclass=10
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
#add=TRUE
)
choroLayer(spdf = spdata,
df = df,
var="localmoran",
col=cols,
nclass=10,
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
add=FALSE
)
choroLayer(spdf = spdata,
df = df,
var="localmoran",
col=cols,
nclass=10,
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
add=FALSE
)
df=data.frame(DCOMIRIS=iris@data$DCOMIRIS,localmoran=localmorans,medincome=jdata$medincome);names(df)[1]="DCOMIRIS"
spdata =merge(iris,df)
par(mfrow=c(2,1))
#plot(spdata, border = NA, col = NA, bg = "#E3DEBF")
choroLayer(spdf = spdata,
df = df,
var="localmoran",
col=cols,
nclass=10,
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
add=FALSE
)
plot(spdata,border = "grey20", lwd=0.75, add=TRUE)
choroLayer(spdf = spdata,
df = df,
var="medincome",
col=cols,
nclass=10,
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
add=FALSE
)
plot(spdata,border = "grey20", lwd=0.75, add=TRUE)
par(mfrow=c(1,2))
#plot(spdata, border = NA, col = NA, bg = "#E3DEBF")
choroLayer(spdf = spdata,
df = df,
var="localmoran",
col=cols,
nclass=10,
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
add=FALSE
)
plot(spdata,border = "grey20", lwd=0.75, add=TRUE)
choroLayer(spdf = spdata,
df = df,
var="medincome",
col=cols,
nclass=10,
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
add=FALSE
)
plot(spdata,border = "grey20", lwd=0.75, add=TRUE)
iris <- readOGR('../Data/raw/iris/shpfr','idf')
plot(iris)
iris <- readOGR('../Data/raw/iris/shpfr','idf')
plot(iris)
ids = as.tbl(data.frame(ids=as.character(iris@data$DCOMIRIS)))
cdata=as.tbl(data.frame(medincome=datacom$RFMQ211,ids=datacom$DCOMIRIS))
idata=as.tbl(data.frame(medincome=datairis$RFMQ211,ids=datairis$DCOMIRIS))
jdata=left_join(ids,cdata,by=c("ids"))
jdata=left_join(jdata,idata,by=c("ids"),copy=TRUE)
jdata$medincome = ifelse(!is.na(jdata$medincome.y),jdata$medincome.y,jdata$medincome.x) # rq : a ifelse could do that easily
jdata
x = jdata$medincome - mean(jdata$medincome,na.rm=TRUE )
x[is.na(x)]=0
centroids = gCentroid(iris,byid = TRUE)
spweights = 1/spDists(centroids@coords)
w=as.matrix(spweights)
diag(w)<- 0
localmorans = (diag(x)%*%w)%*%matrix(x,nrow=length(x))
localmorans = localmorans / ((w%*%matrix(rep(1,length(x)),nrow=length(x)))*(matrix(x,ncol=length(x))%*%matrix(x,nrow=length(x)))[1,1])
localmorans[localmorans==0]=NA
df=data.frame(DCOMIRIS=iris@data$DCOMIRIS,localmoran=localmorans,medincome=jdata$medincome);names(df)[1]="DCOMIRIS"
spdata =merge(iris,df)
par(mfrow=c(1,2))
#plot(spdata, border = NA, col = NA, bg = "#E3DEBF")
choroLayer(spdf = spdata,
df = df,
var="localmoran",
col=cols,
nclass=10,
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
add=FALSE
)
plot(spdata,border = "grey20", lwd=0.75, add=TRUE)
choroLayer(spdf = spdata,
df = df,
var="medincome",
col=cols,
nclass=10,
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
add=FALSE
)
plot(spdata,border = "grey20", lwd=0.75, add=TRUE)
par(mfrow=c(1,2))
#plot(spdata, border = NA, col = NA, bg = "#E3DEBF")
choroLayer(spdf = spdata,
df = df,
var="localmoran",
col=cols,
nclass=10,
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
add=FALSE
)
plot(spdata,border = "grey20", lwd=0.1, add=TRUE)
choroLayer(spdf = spdata,
df = df,
var="medincome",
col=cols,
nclass=10,
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
add=FALSE
)
plot(spdata,border = "grey20", lwd=0.1, add=TRUE)
par(mfrow=c(1,2))
#plot(spdata, border = NA, col = NA, bg = "#E3DEBF")
choroLayer(spdf = spdata,
df = df,
var="localmoran",
col=cols,
nclass=10,
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
add=FALSE
)
#plot(spdata,border = "grey20", lwd=0.1, add=TRUE)
choroLayer(spdf = spdata,
df = df,
var="medincome",
col=cols,
nclass=10,
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
add=FALSE
)
#plot(spdata,border = "grey20", lwd=0.1, add=TRUE)
par(mfrow=c(1,2))
#plot(spdata, border = NA, col = NA, bg = "#E3DEBF")
choroLayer(spdf = spdata,
df = df,
var="localmoran",
col=cols,
nclass=10,
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
add=FALSE,lwd = 0.05
)
#plot(spdata,border = "grey20", lwd=0.1, add=TRUE)
choroLayer(spdf = spdata,
df = df,
var="medincome",
col=cols,
nclass=10,
#breaks = quantile(data$NBMEN11,probs=seq(from=0,to=1,by=0.2),na.rm=TRUE),
add=FALSE,lwd = 0.05
)
#plot(spdata,border = "grey20", lwd=0.1, add=TRUE)
